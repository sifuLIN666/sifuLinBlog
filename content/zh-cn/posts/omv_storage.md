+++
title = 'omv入土教程1'
date = 2026-02-19
draft = false
slug = 'omv_storage'
summary = '返璞归真的OMV系统'
tags = ["omv"]
categories = ["omv从入门到入土"]
series = ["omv从入门到入土"]
math = false
toc = true
comments = true
+++
## 前言
为什么要换OMV呢? 其实有很多原因, 毕竟前段时间国产之光飞牛还爆出来一个非常低级的0day漏洞, 当然对于我这样家庭局域网都有5个网段划分了用户、服务、DMZ的强者而言, 飞牛爆出的漏洞其实对我没有影响。但我为什么还是要换呢? 还不是因为飞牛的共享逻辑实在是诡异, 他好像没办法对多用户进行webdav、smb共享, 对于我这样家庭局域网都有5个网段划分了用户、服务、DMZ的强者而言, 这种权限划分是万万不能接受的, 至于别的nas系统不是盗版就是收费(说的就是你!!unraid!!黑群晖!!),所以就来到了跟毛胚房没什么区别的OMV这里了

## omv的共享文件夹

### 创建文件夹

OMV这个系统要共享文件夹需要首先创建文件夹, 路径**存储器->共享文件夹**, 进入之后选择文件系统、相对路径、权限划分, 权限划分按最小权限原则就行, 反正后面还需要ACL设置。这步结束之后, 就会显示该文件夹的绝对路径

{{<images "https://p.sda1.dev/30/cb03e4762332a5783853051778d1bb4e/PixPin_2026-02-19_23-31-41.png" "显示绝对路径操作步骤">}}

### 新增用户

从**用户->用户**进入路径, 然后创建就好了, 这里的用户一般不需要进行shell登录, 所以Shell那里选nologin就好了, 但是SMB, webdav需要认证用户, 所以密码还是要设置的

## 设置共享

### smb共享

**服务->SMB/CIFS->设置**直接点击启用就好, 之后就不用管了。
**服务->SMB/CIFS->共享**添加共享文件夹, 就选择你要添加的文件夹, 然后把权限和ACL给勾了就行

{{<images "https://p.sda1.dev/30/cb03e4762332a5783853051778d1bb4e/PixPin_2026-02-19_23-31-41.png" "设置smb共享文件夹">}}

做完这步还没完, 因为smb有用户认证, 所以要去共享文件夹目录设置ACL权限, {{<enhence>}}注意是ACL权限, 不是权限按钮, 权限按钮只会服务器访问, 对文件系统的权限半毛钱影响没有, 一般不设置, 走投无路了设置一下也行。{{</enhence>}}

到这一步就算完成了

### webdav共享

首先要去插件装一个webdav的插件, 之后就可以在服务里看到了。webdav其实要比smb简单一点, 因为只要选择共享的文件夹然后启动就好了。不过有几点坑我要说一下

1. User isolation

用户隔离, 听起来很美好的功能, 但是用起来诡异的很, 首先你要在父文件夹有与用户名称相同的文件夹, 否则是没有权限的

比如你共享{{<quote>}}shared{{</quote>}}文件夹, 用户{{<quote>}}lin{{</quote>}}登录, 那你就需要提前在共享文件夹创建好{{<quote>}}lin{{</quote>}}这个目录, 相对路径写{{<quote>}}shared/lin{{</quote>}}就好, 然后{{<quote>}}shared和lin{{</quote>}}两个目录都需要设置ACL权限, 要给{{<enhence>}}webdav-users(group)和www-data(user){{</enhence>}}设置读写权限, 然后路径就填你设置的相对路径就好, 他会自动跳转到对应的子目录里面

2. 用户组别

一定一定要给用户添加一个{{<quote>}}webdav-users{{</quote>}}的组, 因为这个webdav实际上是nginx在写入, 用户只是nginx做认证, 所以有关nginx的两个组{{<quote>}}www-data和webdav-users{{</quote>}}一定要赋予权限

## 结束

好! 讲完了OMV非常基础的设置, 后面应该会讲讲OMV怎么安装docker