<!DOCTYPE html>
<html
  lang="zh-cn"
  dir="ltr"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>
  递归DNS服务器bind9 | 林师傅的贼窝
</title>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
/><link rel="stylesheet" href="/css/root.css" /><link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"
/><link rel="stylesheet" href="/fonts/DingTalk-JinBuTi.woff2" /><link rel="stylesheet" href="/fonts/DingTalk-JinBuTi.woff" /><link rel="stylesheet" href="/fonts/DingTalk-JinBuTi.ttf" /><link rel="stylesheet" href="/fonts/fonts.css" /><link rel="stylesheet" href="/icons/iconfont.ttf" /><link rel="stylesheet" href="/icons/iconfont.woff" /><link rel="stylesheet" href="/icons/iconfont.woff2" /><link rel="stylesheet" href="/icons/iconfont.css" /><link rel="stylesheet" href="/css/header.css" /><link rel="stylesheet" href="/css/content.css" /><link rel="stylesheet" href="/css/footer.css" />
 <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
;
<script src="/js/themeColors.js" defer></script>
<script src="/js/mobile/headerNav.js" defer></script>
<script src="/js/langSwitch.js" defer></script>
<script src="/js/footer/footerStyle.js" defer></script>
<script src="/js/rssCopy.js" defer></script>


  </head>
  <body
    class="dark-mode"
    
  >
    <header class="header-container"><div class="header-title">
  <div class="header-nav-container" id="header-nav-container">
    
  <nav class="header-nav" id="header-nav">
    <a class="header-nav-item" href="/zh-cn//">
      <i class="iconfont icon-Home"></i>首页
    </a>
    <a class="header-nav-item" href="/zh-cn/categories/">
      <i class="iconfont icon-Category"></i>分类
    </a>
    <a class="header-nav-item" href="/zh-cn/posts/">
      <i class="iconfont icon-Archive"></i>归档
    </a>
    <a class="header-nav-item" href="/zh-cn/series/">
      <i class="iconfont icon-Series"></i>系列
    </a>
    <a class="header-nav-item" href="/zh-cn/tags/">
      <i class="iconfont icon-Tags"></i>标签
    </a>
    <a class="header-nav-item" href="/zh-cn/profile/">
      <i class="iconfont icon-Profile"></i>简介
    </a>
    <a class="header-nav-item" href="/zh-cn/link/">
      <i class="iconfont icon-Attachment"></i>友链
    </a>  
  </nav>

  </div>

  <p class="header-author-msg">
    <span class="header-author-title">林师傅的贼窝</span>
    <span class="header-author-description">每天都被折磨的想死</span>
  </p>
  <span class="header-buttons">
    <span class="header-button-container">
      <button id="lang-switch" class="header-button">
        <i class="bi bi-translate"></i>
      </button>
      <div class="header-language" id="header-language-container"><span class="header-language-item" id="en">
          <i class="fi fi-us"></i>
        </span>
        <span class="header-language-item" id="zh-cn">
          <i class="fi fi-cn"></i>
        </span>
        
      </div>
    </span>
    <span class="header-button-container">
      <button id="theme-toggle" class="header-button">
        <i class="iconfont icon-Sun" id="header-theme-button-icon"></i>
      </button>
    </span>
  </span>
</div>
</header>
    <div class="main-container">
      <main>  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dark.min.css"
/>
<link rel="stylesheet" href="/code.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>
<script>
  hljs.highlightAll();
  hljs.initLineNumbersOnLoad();
</script>
<style>
  .post-container article a {
    color: var(--text-color);
    font-weight: 1000;
  }
  .post-container article li {
    font-weight: 1000;
    font-style: oblique;
  }
</style>
<div class="post-container">
  <div
    class="post-title"
    style="display: flex; flex-direction: column; width: 100%"
  >
    <h1 style="text-align: center">递归DNS服务器bind9</h1>
    <time datetime="2024-10-08T00:00:00&#43;00:00" style="margin: 0 auto">
      <i class="bi bi-calendar3" style="margin-right: 3px"></i>
      <span>October 8, 2024</span>
    </time>
  </div>
  <article style="width: 100%; word-break: break-word"><h2 id="前言">前言</h2>
<p>DNS 想必大家并不陌生,但是在主机上设置好 DNS 服务器后,比如 223.5.5.5,那么 223.5.5.5 是怎么找到目标域名的 ip 的呢?全世界那么多网站,要是全依赖 223.5.5.5 的话,那岂不是要炸了?所以肯定是分布式的存储,那么问题来了,DNS 的分布式存储结构是什么样的呢?我们先来看一幅图:</p>
<p><img src="https://s1.locimg.com/2024/10/09/ff50765d9dcdd.png" alt="dns访问流程图"></p>
<p>注意到这张图要访问的<span style="color: rgb(255, 0, 72); font-weight: 1000; font-size: 1.2rem"
  >www.baidu.com.
</span>
注意这个<span style="color: rgb(255, 0, 72); font-weight: 1000; font-size: 1.2rem"
  >"."
</span>
很重要,其实在所有的网站后面都会有这个<span style="color: rgb(255, 0, 72); font-weight: 1000; font-size: 1.2rem"
  >"."
</span>
,这个其实就是根域名,根域名指向的服务器其实就是根服务器,他是 13 个固定的 ip 地址,在 DNS 请求的时候 223.5.5.5 首先会询问根服务器,根服务器会告知.com. 服务器的 ip,之后 223.5.5.5 会问.com. 服务器,.com. 服务器存储着诸如 baidu.com. 的 DNS 服务器的 ip,之后 223.5.5.5 会问存有 baidu.com. 的 DNS 服务器,这些服务器最终返回存储有 <span style="color: rgb(255, 0, 72); font-weight: 1000; font-size: 1.2rem"
  >www.baidu.com.
</span>
 的 ip 的 DNS 服务器,最终 223.5.5.5 去问这个服务器得到 <span style="color: rgb(255, 0, 72); font-weight: 1000; font-size: 1.2rem"
  >www.baidu.com.
</span>
 的 ip,这就可以完成域名解析了.</p>
<p>在这个过程中,PC 发给 223.5.5.5 的请求叫做转发,而 223.5.5.5 的查询过程叫做递归,其中最终查到的<span style="color: rgb(255, 0, 72); font-weight: 1000; font-size: 1.2rem"
  >www.baidu.com.
</span>
的 DNS 服务器就叫做权威 DNS 服务器.</p>
<h3 id="递归服务器的优势">递归服务器的优势</h3>
<p>其实从上面的结果中不难看出,递归查询需要查询多轮,时间上肯定会比转发要长,那我们搭建递归 DNS 服务器有什么意义呢?我们不妨退一步,换个问题,都用公共 DNS 的话,选择哪个 DNS 有什么区别吗?首先我们不考虑延迟这个问题,就返回的解析结果来考虑,不同的 DNS 服务器可能返回不一样的结果。一个常见的场景是,很多域名使用了 CDN,解析结果根据所在地 IP 来返回,比如你是广东电信,返回在广东电信的服务器地址,而在北京联通就返回北京联通的地址,就结果而言,在东南沿海的你显然不希望查询到了一个新疆 CDN 的 ip。虽然有 ECS 这种协议存在(DNS ECS 是 DNS 协议的一个扩展,它允许递归 DNS 解析器在发送给权威 DNS 服务器的请求中包含终端用户 IP 地址数据的部分),但首先它是用在递归 DNS 上的,也就是部署在 114 这种公共服务器上的,其次你请求的域名所在的权威 DNS 要支持 ECS 协议才可以,说白了这个协议对局域网用户来说没什么用,因为你什么都做不了,甚至还可能有隐私泄露的问题。那如果使用自己的递归 DNS 服务器,即把 114 这样的 DNS 服务器装你家里。这样你的每个请求都非常的原生地到达了权威 DNS 服务器,权威 DNS 根据你自建的递归 DNS 的 ip 返回离你最近的 CDN 的 ip,其结果可谓是准确中的准确。你再也不需要对 DNS 服务器进行收集和测速，也不需要对解析结果进行测速,本来就是权威 DNS 根据你家里递归 DNS 发起递归请求的 ip 返回的最优结果,测了也没意义。</p>
<p>还有一个不太常见的问题就是,公共 DNS 服务器值得信任吗?虽然有 DNSSEC 这种东西存在,但它并不能解决 DNS 劫持和污染,你除了知道它结果可能是错的之外什么都做不了。即使 DNS 结果值得信任,但你的查询记录可能会被公共 DNS 服务器记录日志,也就是可能会造成一定的隐私问题。一个更加离谱的可能是,如果公共 DNS 服务器被攻击,那你的查询结果可能被引导到恶意网站,就算这种可能性比较低,公共 DNS 服务器也有故障的时候,你可能又开始考虑:我能保证谁的公共 DNS 服务器 100%稳定性?是的,不能保证。但当你拥有一台属于自己的递归 DNS 服务器的时候,稳定性和隐私问题将由你自己掌控。</p>
<h2 id="搭建内网递归-dns-服务器">搭建内网递归 DNS 服务器</h2>
<p>这里选用 bind9 作为递归服务器,因为 apt 软件源中就有 bind9,而且他还可以配置为权威 DNS 服务器,所以非常方便。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get install -y bind9*
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装好之后配置文件在 /etc/bind,目录结构如下</span>
</span></span><span style="display:flex;"><span>/etc/bind
</span></span><span style="display:flex;"><span>|-- bind.keys
</span></span><span style="display:flex;"><span>|-- db.0
</span></span><span style="display:flex;"><span>|-- db.127
</span></span><span style="display:flex;"><span>|-- db.255
</span></span><span style="display:flex;"><span>|-- db.empty
</span></span><span style="display:flex;"><span>|-- db.local
</span></span><span style="display:flex;"><span>|-- named.conf
</span></span><span style="display:flex;"><span>|-- named.conf.default-zones
</span></span><span style="display:flex;"><span>|-- named.conf.local
</span></span><span style="display:flex;"><span>|-- named.conf.options
</span></span><span style="display:flex;"><span>|-- rndc.key
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>-- zones.rfc1918
</span></span></code></pre></div><p>主文件为<span
  style="
    background-color: #868686;
    padding: 0 5px;
    border-radius: 3px;
    font-size: 1.2rem;
  "
  >name.conf
</span>,其配置文件格式为 C 风格</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">// This is the primary configuration file for the BIND DNS server named.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Please read /usr/share/doc/bind9/README.Debian for information on the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// structure of BIND configuration files in Debian, *BEFORE* you customize
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// this configuration file.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// If you are just adding zones, please do that in /etc/bind/named.conf.local
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>include <span style="color:#e6db74">&#34;/etc/bind/named.conf.options&#34;</span>; <span style="color:#75715e">// 监听配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include <span style="color:#e6db74">&#34;/etc/bind/named.conf.local&#34;</span>; <span style="color:#75715e">// 自定义域名文件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>include <span style="color:#e6db74">&#34;/etc/bind/named.conf.default-zones&#34;</span>; <span style="color:#75715e">// 存储根服务器IP以及回环地址内网网段的信息
</span></span></span></code></pre></div><h3 id="配置监听文件">配置监听文件</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>options {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 缓存文件夹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	directory <span style="color:#e6db74">&#34;/var/cache/bind&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// If there is a firewall between you and nameservers you want
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// to talk to, you may need to fix the firewall to allow multiple
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// If your ISP provided one or more IP addresses for stable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// nameservers, you probably want to use them as forwarders.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// Uncomment the following block, and insert the addresses replacing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// the all-0&#39;s placeholder.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// forwarders {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//  	223.5.5.5;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// };
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//========================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// If BIND logs error messages about the root key being expired,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// you will need to update your keys.  See https://www.isc.org/bind-keys
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//========================================================================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 开启DNSSEC验证,讲道理在内网里面自己用的话这个没啥意义
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	dnssec<span style="color:#f92672">-</span>validation <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>	listen<span style="color:#f92672">-</span>on { localhost; }; <span style="color:#75715e">// 监听本地所有IP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	allow<span style="color:#f92672">-</span>query { any; }; <span style="color:#75715e">// 允许所有IP的DNS请求
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	recursion yes; <span style="color:#75715e">// 开启递归查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	allow<span style="color:#f92672">-</span>recursion { any; }; <span style="color:#75715e">// 允许所有IP都使用递归查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	recursive<span style="color:#f92672">-</span>clients <span style="color:#ae81ff">1024</span>; <span style="color:#75715e">// 最大递归查询客户端数量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div><h3 id="配置自定义域名文件">配置自定义域名文件</h3>
<p>如果有一些特殊需求,比如内网很多服务,其实是可以直接用内网 DNS 服务器避免回环问题的,而且诸如谷歌 TV 激活的 ntp 服务器也可以很方便用内网 DNS 服务器进行 host 劫持,我在这里举一个例子
在<span
  style="
    background-color: #868686;
    padding: 0 5px;
    border-radius: 3px;
    font-size: 1.2rem;
  "
  >name.conf.local
</span>添加如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">// rfc1918主要包含是内网的ip地址段,也就是如果需要由IP解析域名的时候,通过配置这个文件可以马上得到IP所对应的域名而不需要到公网上去反向解析域名,本来就是内网部署,到公网去反向解析简直抽象,这个根据情况可以放开注释
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// include &#34;/etc/bind/zones.rfc1918&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>zone <span style="color:#e6db74">&#34;lzhlovelcl.top&#34;</span> {
</span></span><span style="display:flex;"><span>	type master;
</span></span><span style="display:flex;"><span>	file <span style="color:#e6db74">&#34;/etc/bind/db.example.com&#34;</span>;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>添加好之后,创建配置文件<span
  style="
    background-color: #868686;
    padding: 0 5px;
    border-radius: 3px;
    font-size: 1.2rem;
  "
  >db.example.com
</span></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>touch /etc/bind/db.example.com
</span></span></code></pre></div><p>添加如下内容,各参数意义如下</p>
<ol>
<li>SOA: 起始记录</li>
<li>NS: 名称服务器记录</li>
<li>A: ipv4 记录</li>
<li>IN: 网络记录</li>
<li>TTL: 存活时间</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bind" data-lang="bind"><span style="display:flex;"><span><span style="color:#a6e22e">$TTL</span>	<span style="color:#e6db74">604800</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">设置变量</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">注意邮箱的@的符用.代替,@</span>在这里表示所有域名起始记录的解析.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@</span>	<span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">SOA</span>	lzhlovelcl.top. <span style="color:#e6db74">1982209396</span>.qq.com. (
</span></span><span style="display:flex;"><span>			      <span style="color:#e6db74">2</span>		<span style="color:#75715e">; Serial</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#e6db74">604800</span>		<span style="color:#75715e">; Refresh</span>
</span></span><span style="display:flex;"><span>			  <span style="color:#e6db74">86400</span>		<span style="color:#75715e">; Retry</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">2419200</span>		<span style="color:#75715e">; Expire</span>
</span></span><span style="display:flex;"><span>			 <span style="color:#e6db74">604800</span> )	<span style="color:#75715e">; Negative Cache TTL</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@</span>	        <span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">NS</span>	dns.example.com. <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">指定example.com由dns.example.com</span><span style="color:#960050;background-color:#1e0010">解析</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dns</span>         <span style="color:#66d9ef">IN</span>  <span style="color:#66d9ef">A</span>   <span style="color:#ae81ff">192.168.50.6</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">指定dns.example.com</span><span style="color:#960050;background-color:#1e0010">的IP</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@</span>	        <span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">指定example.com</span><span style="color:#960050;background-color:#1e0010">的IP</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plex</span>	    <span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">指定plex.example.com</span><span style="color:#960050;background-color:#1e0010">的IP</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lucky</span>	    <span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">portainer</span>	<span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">jellyfin</span>	<span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">alist</span>	    <span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">aria2</span>	    <span style="color:#66d9ef">IN</span>	<span style="color:#66d9ef">A</span>	<span style="color:#ae81ff">192.168.50.4</span>
</span></span></code></pre></div><p>这里只是简单示范,更具体的欢迎看这个大佬的<a href="https://blog.51cto.com/weiyigeek/5666940">文章</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 检测配置文件是否正确</span>
</span></span><span style="display:flex;"><span>named-checkconf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认监听53端口,确保没有被占用</span>
</span></span><span style="display:flex;"><span>systemctl enable --now named
</span></span><span style="display:flex;"><span>nslookup whoami.03k.org 223.5.5.5 <span style="color:#75715e"># 测试223.5.5.5换成你装了bind9的主机的IP</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server:         223.5.5.5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Address:        223.5.5.5#53</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Non-authoritative answer:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Name:   whoami.03k.org</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Address: 47.103.54.202 这个就是递归服务器连接到权威DNS的ip,可以复制进浏览器看看ip属地</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ;; Got SERVFAIL reply from 223.5.5.5</span>
</span></span></code></pre></div><p>至此部署完毕,这个项目其实也可以和 singbox 联动形成一个国内国外通吃的超级 dns 服务器,有空再说吧</p>
</article><link
  rel="stylesheet"
  href="https://unpkg.com/@waline/client@v3/dist/waline.css"
/>
<div id="waline"></div>
<script type="module">
  import { init } from "https://unpkg.com/@waline/client@v3/dist/waline.js";
  init({
    el: "#waline",
    serverURL: "https:\/\/sifulinblog-comments.vercel.app",
    placeholder: "请填写正确的昵称和邮箱，方便接收评论回复信息哦。",
    avatar: "mp",
    avatarCDN: "https:\/\/cdn.v2ex.com\/gravatar\/",
    pageSize:  10 ,
    meta: ["nick","mail","link"],
    lang: 'zh-cn',
    highlight:  true ,
    requiredFields: ["nick","mail"]
  });
</script>
<p style="margin-top: 0.5rem">
    <span style="display: flex; flex-wrap: wrap">
      <i class="bi bi-tags-fill"></i>
<a
  href="/zh-cn/tags/dns/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  DNS
</a>
<a
  href="/zh-cn/tags/%E9%80%92%E5%BD%92dns/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  递归DNS
</a>
<a
  href="/zh-cn/tags/bind9/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  Bind9
</a>

    </span>
  </p><p style="margin-top: 0.5rem">
    <span style="display: flex; flex-wrap: wrap">
      <i class="bi bi-grid-fill"></i>
<a
  href="/zh-cn/categories/bind9%E6%95%99%E7%A8%8B/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  Bind9教程
</a>

    </span>
  </p><p style="margin-top: 0.5rem">
    
<style>
  .series-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: 1rem 0;
    height: fit-content;
    width: 100%;
  }
  .series-link {
    display: block;
    text-decoration: none;
    color: var(--text-color);
    margin: 0 0.2rem;
    background: linear-gradient(
      to right,
      var(--header-background-color-from),
      var(--header-background-color-to)
    );
    width: 6rem;
    height: fit-content;
    text-align: center;
    padding: 10px 5px;
    border-radius: 10px;
    font-family: "Dingding";
    margin: 3px 2px;
    transition: 0.5s;
  }
  .series-link:hover {
    transform: scale(1.05);
  }
</style>
<div class="series-container">
  <span style="font-size: 1.2rem; font-family: Dingding">
    DNS从入门到223.5.5.5<i class="bi bi-three-dots"></i>
  </span>
  <div style="display: flex; flex-wrap: wrap; justify-content: center"><a href="/zh-cn/2024/10/08/%E9%80%92%E5%BD%92%E6%9C%8D%E5%8A%A1%E5%99%A8bind9/" class="series-link">递归DNS服务器bind9</a></div>
</div>

  </p>
<style>
  #toc-button {
    background-color: var(--button-color);
    border: none;
    border-radius: 3px;
    padding: 0 2px;
  }
  #toc-button:hover {
    cursor: pointer;
  }
  #toc-button svg {
     
    height: 1.5rem;
    width: 1.5rem;
     
    transition: transform 600ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .line {
    fill: none;
    stroke: var(--text-color);
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-width: 3;
     
    transition: stroke-dasharray 600ms cubic-bezier(0.4, 0, 0.2, 1),
      stroke-dashoffset 600ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .line-top-bottom {
    stroke-dasharray: 12 63;
  }
  [toc-expanded="open"] svg {
    transform: rotate(-45deg);
  }
  [toc-expanded="open"] svg .line-top-bottom {
    stroke-dasharray: 20 300;
    stroke-dashoffset: -32.42;
  }
  #toc-items-container {
    background-color: #72727242;
    padding: 2px 5px;
    border-radius: 5px;
    backdrop-filter: blur(5px);
    overflow-y: auto;
    max-height: 8rem;
  }
  #toc-items-container::-webkit-scrollbar {
    width: 5px;
  }
  #toc-items-container::-webkit-scrollbar-track {
    background-color: #313131;
    border-radius: 2px;
  }
  #toc-items-container::-webkit-scrollbar-thumb {
    background-color: #ffffff6f;
  }
  #toc-items-container a {
    display: block;
    width: 100%;
    text-decoration: none;
    color: var(--text-color);
    margin: 5px 0;
    word-wrap: break-word;
    background-color: #ffffff2b;
    text-align: center;
    border-radius: 3px;
    padding: 3px 0;
  }
  [toc-expanded="open"] + #toc-items-container {
    animation: toc-show 0.5s;
  }
  [toc-expanded="closed"] + #toc-items-container {
    animation: toc-close 0.5s;
  }
  @keyframes toc-show {
    0% {
      transform: translateY(-10%);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }
  @keyframes toc-close {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(-10%);
      opacity: 0;
    }
  }
   
  #toc-items-container ul li {
    width: 7rem;
    font-size: 1rem;
    font-family: "Dingding";
  }
   
  #toc-items-container ul li ul {
    display: flex;
    flex-direction: column;
    align-items: end;
  }
  #toc-items-container ul li ul li {
    width: 5rem;
    font-size: 0.8rem;
    font-family: "Dingding";
  }
</style>
<div style="position: fixed; left: 10px; top: 20%">
  <button id="toc-button" toc-expanded="open">
    <svg viewBox="0 0 32 32">
      <path
        class="line line-top-bottom"
        d="M27 10 13 10C10.8 10 9 8.2 9 6 9 3.5 10.8 2 13 2 15.2 2 17 3.8 17 6L17 26C17 28.2 18.8 30 21 30 23.2 30 25 28.2 25 26 25 23.8 23.2 22 21 22L7 22"
      ></path>
      <path class="line" d="M7 16 27 16"></path>
    </svg>
  </button>

  <div id="toc-items-container"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a>
      <ul>
        <li><a href="#递归服务器的优势">递归服务器的优势</a></li>
      </ul>
    </li>
    <li><a href="#搭建内网递归-dns-服务器">搭建内网递归 DNS 服务器</a>
      <ul>
        <li><a href="#配置监听文件">配置监听文件</a></li>
        <li><a href="#配置自定义域名文件">配置自定义域名文件</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
</div>
<script>
  const tocButton = document.getElementById("toc-button");
  const tocItemsContainer = document.getElementById("toc-items-container");
  tocButton.addEventListener("click", () => {
    const expanded = tocButton.getAttribute("toc-expanded");
    if (expanded === "open") {
      tocButton.setAttribute("toc-expanded", "closed");
    } else {
      tocButton.setAttribute("toc-expanded", "open");
      tocItemsContainer.style.display = "block";
    }
  });
  tocItemsContainer.addEventListener("animationend", () => {
    if (tocButton.getAttribute("toc-expanded") === "closed") {
      tocItemsContainer.style.display = "none";
    }
  });
</script>
</div>

<script src="/js/codeCopy.js" defer></script>  </main>
      <footer class="footer-container" id="footer-container">
        <div class="footer-content">
  <div class="footer-social-container"><a
      class="footer-social-link rss-link"
      id="footer-social-rss.svg"
      href="http://localhost:1313/zh-cn/index.xml"
    >
      <span class="footer-social-text">RSS</span>
    </a>
    <a
      href="https://space.bilibili.com/8337954"
      target="_blank"
      class="footer-social-link"
      id="footer-social-bilibili.svg"
    >
      <span class="footer-social-text">bilibili</span>
    </a>
    
    <a
      href="https://github.com/ProjechAnonym"
      target="_blank"
      class="footer-social-link"
      id="footer-social-github.svg"
    >
      <span class="footer-social-text">gitHub</span>
    </a>
    
    <a
      href="https://t.me/&#43;5yh2rgXjWBlmMDk1"
      target="_blank"
      class="footer-social-link"
      id="footer-social-telegram.svg"
    >
      <span class="footer-social-text">telegram</span>
    </a>
    
    <a
      href="https://qm.qq.com/q/lLbgOB31sW"
      target="_blank"
      class="footer-social-link"
      id="footer-social-qq.svg"
    >
      <span class="footer-social-text">qq</span>
    </a>
    
    <a
      href="https://www.youtube.com/channel/UCXiiRClqjDLrqzMbq2Kqb4A"
      target="_blank"
      class="footer-social-link"
      id="footer-social-youtube.svg"
    >
      <span class="footer-social-text">youtube</span>
    </a>
     
  </div>
  <span class="footer-text"
    >Copyright © 2025. All rights reserved.
  </span>
  <span class="footer-text">Powerd by hugo | Theme is sifu</span>
</div>

      </footer>
    </div>
  </body>
</html>
