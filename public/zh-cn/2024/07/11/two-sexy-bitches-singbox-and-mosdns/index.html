<!DOCTYPE html>
<html
  lang="zh-cn"
  dir="ltr"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>
  双飞singbox和mosdns | 林师傅的贼窝
</title>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
/><link rel="stylesheet" href="/css/root.css" /><link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"
/><link rel="stylesheet" href="/fonts/DingTalk-JinBuTi.woff2" /><link rel="stylesheet" href="/fonts/DingTalk-JinBuTi.woff" /><link rel="stylesheet" href="/fonts/DingTalk-JinBuTi.ttf" /><link rel="stylesheet" href="/fonts/fonts.css" /><link rel="stylesheet" href="/icons/iconfont.ttf" /><link rel="stylesheet" href="/icons/iconfont.woff" /><link rel="stylesheet" href="/icons/iconfont.woff2" /><link rel="stylesheet" href="/icons/iconfont.css" /><link rel="stylesheet" href="/css/header.css" /><link rel="stylesheet" href="/css/content.css" /><link rel="stylesheet" href="/css/footer.css" />
 <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
;
<script src="/js/themeColors.js" defer></script>
<script src="/js/mobile/headerNav.js" defer></script>
<script src="/js/langSwitch.js" defer></script>
<script src="/js/footer/footerStyle.js" defer></script>
<script src="/js/rssCopy.js" defer></script>


  </head>
  <body
    class="dark-mode"
    
  >
    <header class="header-container"><div class="header-title">
  <div class="header-nav-container" id="header-nav-container">
    
  <nav class="header-nav" id="header-nav">
    <a class="header-nav-item" href="/zh-cn//">
      <i class="iconfont icon-Home"></i>首页
    </a>
    <a class="header-nav-item" href="/zh-cn/categories/">
      <i class="iconfont icon-Category"></i>分类
    </a>
    <a class="header-nav-item" href="/zh-cn/posts/">
      <i class="iconfont icon-Archive"></i>归档
    </a>
    <a class="header-nav-item" href="/zh-cn/series/">
      <i class="iconfont icon-Series"></i>系列
    </a>
    <a class="header-nav-item" href="/zh-cn/tags/">
      <i class="iconfont icon-Tags"></i>标签
    </a>
    <a class="header-nav-item" href="/zh-cn/profile/">
      <i class="iconfont icon-Profile"></i>简介
    </a>
    <a class="header-nav-item" href="/zh-cn/link/">
      <i class="iconfont icon-Attachment"></i>友链
    </a>  
  </nav>

  </div>

  <p class="header-author-msg">
    <span class="header-author-title">林师傅的贼窝</span>
    <span class="header-author-description">每天都被折磨的想死</span>
  </p>
  <span class="header-buttons">
    <span class="header-button-container">
      <button id="lang-switch" class="header-button">
        <i class="bi bi-translate"></i>
      </button>
      <div class="header-language" id="header-language-container"><span class="header-language-item" id="en">
          <i class="fi fi-us"></i>
        </span>
        <span class="header-language-item" id="zh-cn">
          <i class="fi fi-cn"></i>
        </span>
        
      </div>
    </span>
    <span class="header-button-container">
      <button id="theme-toggle" class="header-button">
        <i class="iconfont icon-Sun" id="header-theme-button-icon"></i>
      </button>
    </span>
  </span>
</div>
</header>
    <div class="main-container">
      <main>  <link rel="stylesheet" href="/css/code.css" /><style>
  .post-container article a {
    color: var(--text-color);
    font-weight: 1000;
  }
  .post-container article li {
    font-weight: 1000;
    font-style: oblique;
  }
</style>
<div class="post-container">
  <div
    class="post-title"
    style="display: flex; flex-direction: column; width: 100%"
  >
    <h1 style="text-align: center">双飞singbox和mosdns</h1>
    <time datetime="2024-07-11T00:00:00&#43;00:00" style="margin: 0 auto">
      <i class="bi bi-calendar3" style="margin-right: 3px"></i>
      <span>July 11, 2024</span>
    </time>
  </div>
  <article style="width: 100%; word-break: break-word"><h2 id="首先配置系统环境">首先配置系统环境</h2>
<p>首先要安装必要的软件以及系统的配置</p>
<ol>
<li>安装必要的软件</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt-get update
</span></span><span class="line"><span class="cl"><span class="c1"># 安装必要的软件</span>
</span></span><span class="line"><span class="cl">apt-get install -y sudo vim tar unzip resolvconf
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>开启 ipv4 转发</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;net.ipv4.ip_forward=1&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class="line"><span class="cl">sysctl -p
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>修改 dns 服务器为本机 ip</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ****为你的本机 ip</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;nameserver ****&#34;</span> &gt;&gt; /etc/resolvconf/resolv.conf.d/head
</span></span><span class="line"><span class="cl"><span class="c1"># 让配置文件生效</span>
</span></span><span class="line"><span class="cl">resolvconf -u
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>创建文件夹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /opt/mosdns
</span></span><span class="line"><span class="cl">mkdir -p /opt/singbox/lib
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="下载软件">下载软件</h2>
<p>首先去网站下载对应的软件</p>
<ul>
<li><a href="https://github.com/SagerNet/sing-box/releases">sing-box 链接</a></li>
</ul>
<ul>
<li><a href="https://github.com/IrineSistiana/mosdns/releases">mosdns 链接</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 上传压缩包到 root 目录下,非 root 用户改为绝对路径</span>
</span></span><span class="line"><span class="cl">unzip mosdns-*.zip <span class="s2">&#34;mosdns&#34;</span> -d /opt/mosdns/
</span></span><span class="line"><span class="cl">tar -zxvf sing-box-*.tar.gz --strip-components<span class="o">=</span><span class="m">1</span> -C /opt/singbox/
</span></span><span class="line"><span class="cl">chmod +x /opt/singbox/sing-box
</span></span><span class="line"><span class="cl">chmod +x /opt/mosdns/mosdns
</span></span><span class="line"><span class="cl"><span class="c1"># singbox的默认运行配置</span>
</span></span><span class="line"><span class="cl">cat &gt; /opt/singbox/config.json <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">{
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;log&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;level&#34;: &#34;info&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  },
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;dns&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;servers&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;address&#34;: &#34;tls://8.8.8.8&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">    ]
</span></span></span><span class="line"><span class="cl"><span class="s">  },
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;inbounds&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">    {
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;type&#34;: &#34;shadowsocks&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;listen&#34;: &#34;::&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;listen_port&#34;: 8080,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;sniff&#34;: true,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;network&#34;: &#34;tcp&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;method&#34;: &#34;2022-blake3-aes-128-gcm&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;password&#34;: &#34;8JCsPssfgS8tiRwiMlhARg==&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">    }
</span></span></span><span class="line"><span class="cl"><span class="s">  ],
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;outbounds&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">    {
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;type&#34;: &#34;direct&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">    },
</span></span></span><span class="line"><span class="cl"><span class="s">    {
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;type&#34;: &#34;dns&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">      &#34;tag&#34;: &#34;dns-out&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">    }
</span></span></span><span class="line"><span class="cl"><span class="s">  ],
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;route&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="s">    &#34;rules&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="s">      {
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;protocol&#34;: &#34;dns&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s">        &#34;outbound&#34;: &#34;dns-out&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">      }
</span></span></span><span class="line"><span class="cl"><span class="s">    ]
</span></span></span><span class="line"><span class="cl"><span class="s">  }
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">cat &gt; /opt/mosdns/config.yaml <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">log:
</span></span></span><span class="line"><span class="cl"><span class="s">  level: info
</span></span></span><span class="line"><span class="cl"><span class="s">  file: &#34;/opt/mosdns/mosdns.log&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">api:
</span></span></span><span class="line"><span class="cl"><span class="s">  http: &#34;0.0.0.0:9091&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">include: []
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">plugins:
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: hosts
</span></span></span><span class="line"><span class="cl"><span class="s">    type: hosts
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      entries:
</span></span></span><span class="line"><span class="cl"><span class="s">        - &#34;woshiwo.com 192.168.234.4&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">        - &#34;shibuyiyangdeyanhuo.com 192.168.234.2&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: forward_dns
</span></span></span><span class="line"><span class="cl"><span class="s">    type: forward
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      concurrent: 1
</span></span></span><span class="line"><span class="cl"><span class="s">      upstreams:
</span></span></span><span class="line"><span class="cl"><span class="s">        - addr: 1.1.1.1
</span></span></span><span class="line"><span class="cl"><span class="s">          bootstrap: 119.29.29.29
</span></span></span><span class="line"><span class="cl"><span class="s">          enable_pipeline: false
</span></span></span><span class="line"><span class="cl"><span class="s">          max_conns: 2
</span></span></span><span class="line"><span class="cl"><span class="s">          insecure_skip_verify: false
</span></span></span><span class="line"><span class="cl"><span class="s">          idle_timeout: 30
</span></span></span><span class="line"><span class="cl"><span class="s">          enable_http3: false
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: dns_sequence
</span></span></span><span class="line"><span class="cl"><span class="s">    type: sequence
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      - exec: prefer_ipv4
</span></span></span><span class="line"><span class="cl"><span class="s">      - exec: \$forward_dns
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: dns_query
</span></span></span><span class="line"><span class="cl"><span class="s">    type: sequence
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      - exec: \$dns_sequence
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: fallback
</span></span></span><span class="line"><span class="cl"><span class="s">    type: fallback
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      primary: dns_query
</span></span></span><span class="line"><span class="cl"><span class="s">      secondary: dns_query
</span></span></span><span class="line"><span class="cl"><span class="s">      threshold: 500
</span></span></span><span class="line"><span class="cl"><span class="s">      always_standby: true
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: main_sequence
</span></span></span><span class="line"><span class="cl"><span class="s">    type: sequence
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      - exec: \$hosts
</span></span></span><span class="line"><span class="cl"><span class="s">      - matches:
</span></span></span><span class="line"><span class="cl"><span class="s">        - has_resp
</span></span></span><span class="line"><span class="cl"><span class="s">        exec: accept
</span></span></span><span class="line"><span class="cl"><span class="s">      - exec: \$fallback
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: udp_server
</span></span></span><span class="line"><span class="cl"><span class="s">    type: udp_server
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      entry: main_sequence
</span></span></span><span class="line"><span class="cl"><span class="s">      listen: &#34;0.0.0.0:53&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  - tag: tcp_server
</span></span></span><span class="line"><span class="cl"><span class="s">    type: tcp_server
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">      entry: main_sequence
</span></span></span><span class="line"><span class="cl"><span class="s">      listen: &#34;0.0.0.0:53&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="配置辣种服务方便开机坐上来自己动">配置辣种服务,方便开机坐上来自己动</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat &gt; /etc/systemd/system/sing-box.service <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[Unit]
</span></span></span><span class="line"><span class="cl"><span class="s">Description=sing-box service
</span></span></span><span class="line"><span class="cl"><span class="s">Documentation=https://sing-box.sagernet.org
</span></span></span><span class="line"><span class="cl"><span class="s">After=network.target nss-lookup.target network-online.target
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">[Service]
</span></span></span><span class="line"><span class="cl"><span class="s">CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_SYS_PTRACE CAP_DAC_READ_SEARCH
</span></span></span><span class="line"><span class="cl"><span class="s">AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_SYS_PTRACE CAP_DAC_READ_SEARCH
</span></span></span><span class="line"><span class="cl"><span class="s">ExecStart=/opt/singbox/sing-box -D /opt/singbox/lib -c /opt/singbox/config.json run
</span></span></span><span class="line"><span class="cl"><span class="s">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span class="line"><span class="cl"><span class="s">Restart=on-failure
</span></span></span><span class="line"><span class="cl"><span class="s">RestartSec=10s
</span></span></span><span class="line"><span class="cl"><span class="s">LimitNOFILE=infinity
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">[Install]
</span></span></span><span class="line"><span class="cl"><span class="s">WantedBy=multi-user.target
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">cat &gt; /etc/systemd/system/mosdns.service <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[Unit]
</span></span></span><span class="line"><span class="cl"><span class="s">Description=A DNS forwarder
</span></span></span><span class="line"><span class="cl"><span class="s">ConditionFileIsExecutable=/opt/mosdns/mosdns
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">[Service]
</span></span></span><span class="line"><span class="cl"><span class="s">StartLimitInterval=5
</span></span></span><span class="line"><span class="cl"><span class="s">StartLimitBurst=10
</span></span></span><span class="line"><span class="cl"><span class="s">ExecStart=/opt/mosdns/mosdns &#34;start&#34; &#34;--as-service&#34; &#34;-d&#34; &#34;/opt/mosdns&#34; &#34;-c&#34; &#34;/opt/mosdns/config.yaml&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Restart=always
</span></span></span><span class="line"><span class="cl"><span class="s">RestartSec=120
</span></span></span><span class="line"><span class="cl"><span class="s">EnvironmentFile=-/etc/sysconfig/mosdns
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">[Install]
</span></span></span><span class="line"><span class="cl"><span class="s">WantedBy=multi-user.target
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">systemctl daemon-reload
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> sing-box.service
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> mosdns.service
</span></span><span class="line"><span class="cl">systemctl start sing-box.service
</span></span><span class="line"><span class="cl">systemctl start mosdns.service
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="yua-和-eimi-的一番赛高使用方式">yua 和 eimi 的一番赛高使用方式</h2>
<p>由于 singbox 的似乎不具备 host 劫持的能力,反正我没看到,所以在此引入了 mosdns 作为 host 劫持的服务,内网设备将 dns 服务器指向本方案主机,由于是内网的 ip 段,singbox 不会劫持该 dns 请求,而 mosdns 则正常监听 53 端口,所以会接收到 dns 请求,之后 mosdns 根据 host 列表决定是否向上级 dns 查询,如果命中 host 列表,则返回 host 对应的 ip,否则向上级查询 dns,但是发出的 dns 请求是像公网请求的,此时会被 sing-box 的 dns 模块劫持,之后会根据 sing-box 的配置,将请求转发到指定的服务器,mosdns 在这个方案中只是补全了 sing-box 没有的 host 劫持能力</p>
<h2 id="结束">结束</h2>
<p>这样就可以愉快的让 yua 和 eimi 坐上来自己动了</p>
</article><link
  rel="stylesheet"
  href="https://unpkg.com/@waline/client@v3/dist/waline.css"
/>
<div id="waline"></div>
<script type="module">
  import { init } from "https://unpkg.com/@waline/client@v3/dist/waline.js";
  init({
    el: "#waline",
    serverURL: "https:\/\/sifulinblog-comments.vercel.app",
    placeholder: "请填写正确的昵称和邮箱，方便接收评论回复信息哦。",
    avatar: "mp",
    avatarCDN: "https:\/\/cdn.v2ex.com\/gravatar\/",
    pageSize:  10 ,
    meta: ["nick","mail","link"],
    lang: 'zh-cn',
    highlight:  true ,
    requiredFields: ["nick","mail"]
  });
</script>
<p style="margin-top: 0.5rem">
    <span style="display: flex; flex-wrap: wrap">
      <i class="bi bi-tags-fill"></i>
<a
  href="/zh-cn/tags/singbox/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  Singbox
</a>
<a
  href="/zh-cn/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  科学上网
</a>
<a
  href="/zh-cn/tags/mosdns/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  Mosdns
</a>
<a
  href="/zh-cn/tags/host%E5%8A%AB%E6%8C%81/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  Host劫持
</a>

    </span>
  </p><p style="margin-top: 0.5rem">
    <span style="display: flex; flex-wrap: wrap">
      <i class="bi bi-grid-fill"></i>
<a
  href="/zh-cn/categories/singbox%E5%8D%81%E7%82%B9%E4%B8%8D%E9%80%9A/"
  style="
    color: var(--text-color);
    text-decoration: none;
    background-color: #717171a2;
    padding: 2px;
    border-radius: 3px;
    margin: 1px 0.2rem;
    text-align: center;
  "
>
  Singbox十点不通
</a>

    </span>
  </p><p style="margin-top: 0.5rem">
    
<style>
  .series-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: 1rem 0;
    height: fit-content;
    width: 100%;
  }
  .series-link {
    display: block;
    text-decoration: none;
    color: var(--text-color);
    margin: 0 0.2rem;
    background: linear-gradient(
      to right,
      var(--header-background-color-from),
      var(--header-background-color-to)
    );
    width: 6rem;
    height: fit-content;
    text-align: center;
    padding: 10px 5px;
    border-radius: 10px;
    font-family: "Dingding";
    margin: 3px 2px;
    transition: 0.5s;
  }
  .series-link:hover {
    transform: scale(1.05);
  }
</style>
<div class="series-container">
  <span style="font-size: 1.2rem; font-family: Dingding">
    Singbox:从入门到clash<i class="bi bi-three-dots"></i>
  </span>
  <div style="display: flex; flex-wrap: wrap; justify-content: center"><a href="/zh-cn/2024/07/11/two-sexy-bitches-singbox-and-mosdns/" class="series-link">双飞singbox和mosdns</a><a href="/zh-cn/2024/06/07/introduce-singbox-part1/" class="series-link">初识singbox</a></div>
</div>

  </p>
<style>
  #toc-button {
    background-color: var(--button-color);
    border: none;
    border-radius: 3px;
    padding: 0 2px;
  }
  #toc-button:hover {
    cursor: pointer;
  }
  #toc-button svg {
     
    height: 1.5rem;
    width: 1.5rem;
     
    transition: transform 600ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .line {
    fill: none;
    stroke: var(--text-color);
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-width: 3;
     
    transition: stroke-dasharray 600ms cubic-bezier(0.4, 0, 0.2, 1),
      stroke-dashoffset 600ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .line-top-bottom {
    stroke-dasharray: 12 63;
  }
  [toc-expanded="open"] svg {
    transform: rotate(-45deg);
  }
  [toc-expanded="open"] svg .line-top-bottom {
    stroke-dasharray: 20 300;
    stroke-dashoffset: -32.42;
  }
  #toc-items-container {
    background-color: #72727242;
    padding: 2px 5px;
    border-radius: 5px;
    backdrop-filter: blur(5px);
    overflow-y: auto;
    max-height: 8rem;
  }
  #toc-items-container::-webkit-scrollbar {
    width: 5px;
  }
  #toc-items-container::-webkit-scrollbar-track {
    background-color: #313131;
    border-radius: 2px;
  }
  #toc-items-container::-webkit-scrollbar-thumb {
    background-color: #ffffff6f;
  }
  #toc-items-container a {
    display: block;
    width: 100%;
    text-decoration: none;
    color: var(--text-color);
    margin: 5px 0;
    word-wrap: break-word;
    background-color: #ffffff2b;
    text-align: center;
    border-radius: 3px;
    padding: 3px 0;
  }
  [toc-expanded="open"] + #toc-items-container {
    animation: toc-show 0.5s;
  }
  [toc-expanded="closed"] + #toc-items-container {
    animation: toc-close 0.5s;
  }
  @keyframes toc-show {
    0% {
      transform: translateY(-10%);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }
  @keyframes toc-close {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    100% {
      transform: translateY(-10%);
      opacity: 0;
    }
  }
   
  #toc-items-container ul li {
    width: 7rem;
    font-size: 1rem;
    font-family: "Dingding";
  }
   
  #toc-items-container ul li ul {
    display: flex;
    flex-direction: column;
    align-items: end;
  }
  #toc-items-container ul li ul li {
    width: 5rem;
    font-size: 0.8rem;
    font-family: "Dingding";
  }
</style>
<div style="position: fixed; left: 10px; top: 20%">
  <button id="toc-button" toc-expanded="open">
    <svg viewBox="0 0 32 32">
      <path
        class="line line-top-bottom"
        d="M27 10 13 10C10.8 10 9 8.2 9 6 9 3.5 10.8 2 13 2 15.2 2 17 3.8 17 6L17 26C17 28.2 18.8 30 21 30 23.2 30 25 28.2 25 26 25 23.8 23.2 22 21 22L7 22"
      ></path>
      <path class="line" d="M7 16 27 16"></path>
    </svg>
  </button>

  <div id="toc-items-container"><nav id="TableOfContents">
  <ul>
    <li><a href="#首先配置系统环境">首先配置系统环境</a></li>
    <li><a href="#下载软件">下载软件</a>
      <ul>
        <li><a href="#配置辣种服务方便开机坐上来自己动">配置辣种服务,方便开机坐上来自己动</a></li>
      </ul>
    </li>
    <li><a href="#yua-和-eimi-的一番赛高使用方式">yua 和 eimi 的一番赛高使用方式</a></li>
    <li><a href="#结束">结束</a></li>
  </ul>
</nav></div>
</div>
<script>
  const tocButton = document.getElementById("toc-button");
  const tocItemsContainer = document.getElementById("toc-items-container");
  tocButton.addEventListener("click", () => {
    const expanded = tocButton.getAttribute("toc-expanded");
    if (expanded === "open") {
      tocButton.setAttribute("toc-expanded", "closed");
    } else {
      tocButton.setAttribute("toc-expanded", "open");
      tocItemsContainer.style.display = "block";
    }
  });
  tocItemsContainer.addEventListener("animationend", () => {
    if (tocButton.getAttribute("toc-expanded") === "closed") {
      tocItemsContainer.style.display = "none";
    }
  });
</script>
</div>

<script src="/js/codeCopy.js" defer></script>  </main>
      <footer class="footer-container" id="footer-container">
        <div class="footer-content">
  <div class="footer-social-container"><a
      class="footer-social-link rss-link"
      id="footer-social-rss.svg"
      href="http://localhost:1313/zh-cn/index.xml"
    >
      <span class="footer-social-text">RSS</span>
    </a>
    <a
      href="https://space.bilibili.com/8337954"
      target="_blank"
      class="footer-social-link"
      id="footer-social-bilibili.svg"
    >
      <span class="footer-social-text">bilibili</span>
    </a>
    
    <a
      href="https://github.com/ProjechAnonym"
      target="_blank"
      class="footer-social-link"
      id="footer-social-github.svg"
    >
      <span class="footer-social-text">gitHub</span>
    </a>
    
    <a
      href="https://t.me/&#43;5yh2rgXjWBlmMDk1"
      target="_blank"
      class="footer-social-link"
      id="footer-social-telegram.svg"
    >
      <span class="footer-social-text">telegram</span>
    </a>
    
    <a
      href="https://qm.qq.com/q/lLbgOB31sW"
      target="_blank"
      class="footer-social-link"
      id="footer-social-qq.svg"
    >
      <span class="footer-social-text">qq</span>
    </a>
    
    <a
      href="https://www.youtube.com/channel/UCXiiRClqjDLrqzMbq2Kqb4A"
      target="_blank"
      class="footer-social-link"
      id="footer-social-youtube.svg"
    >
      <span class="footer-social-text">youtube</span>
    </a>
     
  </div>
  <span class="footer-text"
    >Copyright © 2024. All rights reserved.
  </span>
  <span class="footer-text">Powerd by hugo | Theme is sifu</span>
</div>

      </footer>
    </div>
  </body>
</html>
